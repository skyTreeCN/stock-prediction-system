# 股票预测系统 - 项目总览

## 🎯 项目目标

构建一个本地运行的股票预测系统，通过 Claude AI 分析上交所股票历史数据，预测未来3天上涨概率高于95%的股票。

## 📊 系统架构图

```
┌─────────────────────────────────────────────────────────────┐
│                        用户界面                              │
│                    (Next.js Frontend)                        │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐        │
│  │ 区域1:       │ │ 区域2:       │ │ 区域3:       │        │
│  │ 数据获取     │ │ 数据分析     │ │ 相似性分析   │        │
│  └──────────────┘ └──────────────┘ └──────────────┘        │
└────────────────────┬────────────────────────────────────────┘
                     │ HTTP/REST API
┌────────────────────┴────────────────────────────────────────┐
│                   FastAPI 后端服务                           │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐        │
│  │ DataFetcher  │ │   Analyzer   │ │   Database   │        │
│  │  (AkShare)   │ │  (Claude AI) │ │  (SQLite)    │        │
│  └──────────────┘ └──────────────┘ └──────────────┘        │
└─────────────────────────────────────────────────────────────┘
         │                  │                  │
         ▼                  ▼                  ▼
  ┌─────────────┐   ┌─────────────┐   ┌─────────────┐
  │   AkShare   │   │  Claude API │   │ SQLite DB   │
  │  数据源     │   │  (Anthropic)│   │  (本地)     │
  └─────────────┘   └─────────────┘   └─────────────┘
```

## 🔄 数据流程

### 1️⃣ 数据获取流程
```
用户点击按钮
  → FastAPI 启动后台任务
  → AkShare 获取上交所股票列表（约2000只）
  → 逐个获取每只股票3年的日K线数据
  → 保存到 SQLite 数据库
  → 返回统计信息
```

### 2️⃣ 模式分析流程
```
用户点击分析按钮
  → 从数据库提取50个历史上涨案例
    （连续3天收盘价上涨的股票）
  → 将数据发送给 Claude AI
  → Claude 分析共性特征
  → 返回5-10种上涨模式
  → 保存到数据库
```

### 3️⃣ 预测流程
```
用户点击预测按钮
  → 获取所有股票最近30天数据
  → 按批次（每批50只）发送给 Claude AI
  → Claude 对比上涨模式，计算相似度
  → 返回每只股票的上涨概率（0-100）
  → 按概率降序排列
  → 展示前100只股票
```

## 📁 文件结构说明

```
Stock/
│
├── backend/                         # Python 后端
│   ├── app/
│   │   ├── main.py                 # FastAPI 主程序（路由、API）
│   │   ├── data_fetcher.py         # 数据获取模块（AkShare）
│   │   ├── database.py             # 数据库操作模块（SQLite）
│   │   ├── analyzer.py             # AI 分析模块（Claude）
│   │   └── models.py               # Pydantic 数据模型
│   ├── requirements.txt            # Python 依赖清单
│   ├── .env.example               # 环境变量模板
│   └── start.bat                  # Windows 启动脚本
│
├── frontend/                        # Next.js 前端
│   ├── app/
│   │   ├── page.tsx               # 主页面（组合三个区域）
│   │   ├── layout.tsx             # 布局组件
│   │   └── globals.css            # 全局样式（TailwindCSS）
│   ├── components/
│   │   ├── DataFetcher.tsx        # 区域1组件（数据获取）
│   │   ├── DataAnalyzer.tsx       # 区域2组件（模式分析）
│   │   └── SimilarityAnalysis.tsx # 区域3组件（相似度预测）
│   ├── package.json               # Node.js 依赖
│   ├── tsconfig.json              # TypeScript 配置
│   ├── tailwind.config.ts         # TailwindCSS 配置
│   └── start.bat                  # Windows 启动脚本
│
├── data/
│   └── stocks.db                  # SQLite 数据库（自动创建）
│
├── README.md                       # 完整使用文档
├── INSTALL.md                      # 快速安装指南
├── PROJECT_OVERVIEW.md             # 本文档
├── Stock PJ.txt                    # 原始需求文档
└── .gitignore                      # Git 忽略文件
```

## 🔑 核心模块说明

### 后端核心模块

#### 1. main.py（FastAPI 主程序）
- **作用**：提供 RESTful API 接口
- **主要路由**：
  - `POST /api/fetch-data` - 启动数据获取
  - `POST /api/analyze` - 启动模式分析
  - `POST /api/predict` - 启动预测
  - `GET /api/statistics` - 获取数据统计
  - `GET /api/patterns` - 获取识别的模式
  - `GET /api/predictions` - 获取预测结果
  - `GET /api/task-status/{task_name}` - 查询任务状态

#### 2. data_fetcher.py（数据获取）
- **作用**：使用 AkShare 获取股票数据
- **关键方法**：
  - `get_stock_list()` - 获取上交所股票列表
  - `fetch_stock_data()` - 获取单只股票历史数据
  - `fetch_all_stocks()` - 批量获取所有股票

#### 3. database.py（数据库操作）
- **作用**：SQLite 数据库增删改查
- **数据表**：
  - `stock_data` - K线数据表
  - `rising_patterns` - 上涨模式表
- **关键方法**：
  - `save_stock_data()` - 保存股票数据
  - `get_rising_samples()` - 获取上涨案例
  - `get_recent_data_all_stocks()` - 获取最近数据

#### 4. analyzer.py（AI 分析）
- **作用**：调用 Claude API 进行分析
- **关键方法**：
  - `analyze_rising_patterns()` - 分析上涨模式
  - `predict_stock_probability()` - 预测股票概率

### 前端核心组件

#### 1. DataFetcher.tsx（区域1）
- 数据获取按钮
- 任务状态轮询
- 数据统计展示

#### 2. DataAnalyzer.tsx（区域2）
- 模式分析按钮
- 识别的模式列表展示

#### 3. SimilarityAnalysis.tsx（区域3）
- 预测按钮
- 预测结果表格（前100只股票）
- 概率颜色编码

## 💡 技术亮点

### 1. 后台任务处理
使用 FastAPI 的 `BackgroundTasks` 处理耗时操作，避免 HTTP 超时

### 2. 任务状态管理
通过全局状态字典实时跟踪任务进度

### 3. 批量处理
将 2000 只股票分批发送给 Claude，控制 token 使用

### 4. 响应式 UI
使用 TailwindCSS 构建美观的响应式界面

### 5. 实时反馈
前端轮询后端任务状态，实时展示进度

## 🎨 界面预览

### 区域1：数据获取
```
┌────────────────────────────────────────┐
│ 区域1：数据获取                         │
├────────────────────────────────────────┤
│ [获取上交所股票数据] 按钮               │
│                                        │
│ 状态：正在获取数据... (进度条 50%)     │
│                                        │
│ 数据统计：                             │
│   股票数量：2000                       │
│   数据记录：1,500,000                  │
│   日期范围：2021-12-03 ~ 2024-12-03   │
└────────────────────────────────────────┘
```

### 区域2：数据分析
```
┌────────────────────────────────────────┐
│ 区域2：数据分析                         │
├────────────────────────────────────────┤
│ [分析上涨模式] 按钮                     │
│                                        │
│ 识别出的上涨模式：                      │
│ ┌──────────────────────────────┐      │
│ │ 突破上升模式                  │      │
│ │ 特征：连续阳线、突破前高...   │      │
│ └──────────────────────────────┘      │
└────────────────────────────────────────┘
```

### 区域3：相似性分析
```
┌────────────────────────────────────────┐
│ 区域3：相似性分析与预测                 │
├────────────────────────────────────────┤
│ [开始预测] 按钮                         │
│                                        │
│ 预测结果（前100只股票）：               │
│ ┌──────┬────────┬──────┬─────┬─────┐ │
│ │ 排名 │ 代码   │ 名称 │ 概率│ 原因│ │
│ ├──────┼────────┼──────┼─────┼─────┤ │
│ │  1   │600519  │贵州茅台│95.2%│...│ │
│ │  2   │600036  │招商银行│93.8%│...│ │
│ └──────┴────────┴──────┴─────┴─────┘ │
└────────────────────────────────────────┘
```

## 📈 性能指标

### 数据规模
- 股票数量：约 2000 只
- 时间跨度：3 年
- 数据记录：约 150 万条
- 数据库大小：约 200-300 MB

### 时间估算
- 数据获取：10-30 分钟（首次）
- 模式分析：1-3 分钟
- 预测运行：3-10 分钟

### 成本估算
- 首次分析：$0.15-$0.30
- 每次预测：$0.10-$0.20
- 月度成本：$3-$6（每天预测）

## 🚀 快速上手

1. **安装依赖**（参考 INSTALL.md）
2. **配置 API Key**（在 backend/.env）
3. **启动后端**（运行 backend/start.bat）
4. **启动前端**（运行 frontend/start.bat）
5. **访问系统**（http://localhost:3000）
6. **按顺序使用**：获取数据 → 分析模式 → 预测股票

## ⚠️ 重要提醒

1. **首次使用**必须先获取数据（区域1）
2. **必须先分析**模式（区域2）才能预测
3. **数据更新**建议每周一次
4. **投资风险**：预测仅供参考，不构成投资建议

## 📚 进一步学习

- **FastAPI 文档**: https://fastapi.tiangolo.com/
- **Next.js 文档**: https://nextjs.org/docs
- **AkShare 文档**: https://akshare.akfamily.xyz/
- **Claude API 文档**: https://docs.anthropic.com/

## 🔗 相关文件

- [README.md](README.md) - 完整使用文档
- [INSTALL.md](INSTALL.md) - 安装指南
- [Stock PJ.txt](Stock PJ.txt) - 原始需求

---

**项目完成！** 所有代码已可直接运行。祝您使用愉快！
